function [Y,Xf,Af] = NN_after_statistics(X,~,~)
%MYNEURALNETWORKFUNCTION neural network simulation function.
%
% Auto-generated by MATLAB, 12-Nov-2018 21:34:33.
%
% [Y] = myNeuralNetworkFunction(X,~,~) takes these arguments:
%
%   X = 1xTS cell, 1 inputs over TS timesteps
%   Each X{1,ts} = Qx40 matrix, input #1 at timestep ts.
%
% and returns:
%   Y = 1xTS cell of 1 outputs over TS timesteps.
%   Each Y{1,ts} = Qx12 matrix, output #1 at timestep ts.
%
% where Q is number of samples (or series) and TS is the number of timesteps.

%#ok<*RPMT0>

% ===== NEURAL NETWORK CONSTANTS =====

% Input 1
x1_step1.xoffset = [0.0024;0.00228571428571429;0.0024;0.00228571428571429;0.0024;0.00228571428571429;0.0024;0.00615238095238095;0.00228571428571429;0.0024;0.0024;0.00234216017507648;0.0024;0.00234216017507648;0.0024;0.00234216017507648;0.0024;0.00700802261357517;0.00234216017507648;0.0024;0;0;0;0;0;0;0;0.00163721598772923;0;0;0;0;0;0;0;0;0;0.017;0;0];
x1_step1.gain = [1.15633354165692;0.890045477085567;1.88955973258231;7.93770789234956;8.63451338349575;3.94088669950739;0.429658288671036;0.823944615227674;1.4412534787398;1.66015123187174;1.12734233406748;0.888590373134595;1.87726580798997;7.8454254443853;8.57695646796242;3.9076223866949;0.429658218997415;0.816669233809054;1.42544593405551;1.62736158155387;3.8919389345388;3.77202389666602;4.44368384282091;17.1872818656623;50.3760613775825;27.6120788446516;1.99135935430667;3.03062915364626;4.25406302353157;7.74062922626341;0.694830461367426;1.01507384662234;1.31509731720147;4.20079815164881;9.09504320145521;4.62748727440999;0.341623394370046;0.692472820441798;0.983380863408398;1.32555673382821];
x1_step1.ymin = -1;

% Layer 1
b1 = [-0.6334332229786288071;-0.71788066692316121475;-0.69817335500732569109;-0.5673228716731004706;-0.40190525955289152504;0.11660822352157215742;-1.571413131361347526;-0.51576555508940602479;-0.70143117419441558535;-2.0930582737477028132];
IW1_1 = [0.8516850240021827112 -0.24383977894831618261 -0.15189277897216327262 0.34499253017955461287 -1.03557080298390769 -1.2328432984534438699 -0.36508604377341763447 1.1494492068466870549 -0.56262603223533946828 -0.7289478607118554665 0.42752582695524893319 -0.044348089865426695844 0.17286004496601412028 0.69995315599689955643 -0.52631265021223072598 -1.2567506644349233369 -0.75568753360597584745 1.7637451247352839978 -0.27726992943765732536 -0.20881612195813786803 0.84677558619489234903 0.0073113565352668835259 -0.3196983431140265064 0.23994631736049132353 -0.60309797676166132518 -0.73419461531089746931 -0.38284790514373195913 1.0814014403010843157 0.16623545439273584856 -0.14157008251236827268 0.87721293337563832626 -0.1564811006363155399 -0.25578750561396007557 0.80295027490989590024 -0.60717386131716544195 -1.2610930850118917679 0.34231107360217932767 2.1003763102215184944 -0.24862507903099920203 -0.12919313379865593472;0.062534442751124880155 0.82676974543011594321 0.67735773319798098235 -1.0031434025762677731 0.022335543275082445774 -0.032814252105255611869 0.10640310591838986198 0.65782703289168209526 -0.89895696416159975861 -1.0439509412582101966 -0.23487360665020662331 0.9103252971316133646 1.3130425813799537771 -0.54615278934277933232 0.071319598283566210117 -0.37954710769990879227 0.12310918721534913622 0.72143692866012809617 -0.97190473236841912197 -1.6038160588269627649 -0.75168324707245326444 0.72325299401880871475 0.43323661836138527281 -0.82628900436133245755 0.24738813953264798817 0.177615873048181383 0.56208895951897785981 0.40261407326586212685 -0.37643716594550974408 -0.56961194452782126785 -0.63801099975140496134 1.2678468448095743248 0.57444444978946473945 -1.3894136415416500352 0.11681982082467644302 0.31696412151752212383 0.57075901632739023395 1.1188575831609559597 -0.33000835671828671058 -0.90709243950448636973;0.61909589681063015298 0.098555271213033202038 0.16117088856603978275 0.31590456756842266728 -0.36531961926035261268 0.19713537131232483635 -0.011486606404112274793 0.13449975121211715789 -0.35917202659466657133 -0.14104021133298710877 0.84649497441810261922 -0.20614385386318967441 0.30813141663867166242 0.35518537149510098772 0.27021632018602570469 0.0058418132010576075824 -0.20855421284140276961 -0.53067672608065541429 -0.42156257802493463105 -0.032080957374015929562 0.22673229928064217442 -0.17661103273181771867 -0.026665726532274464794 0.53010305235437549243 0.079348190305948279599 -0.49418230923278316791 0.27413964881425145759 0.19695641641757319351 0.15340202548959872009 0.023871302898763602229 0.066323764745248842134 0.28988631373051104712 0.36919317739096702002 0.73063819142076991131 -0.22704324280559978755 0.058552748376382850182 -0.21263456701858421405 -0.070816938855106495443 0.00096947309320849365047 0.45199926183264221846;0.12518330762857229899 0.42303059158816813667 0.37832949274268606876 -0.28588565511738006641 0.30520137533603219904 0.06160540178628475666 -0.014545097699897058599 0.51344009969437731655 -0.15693891259440850838 0.13987359049029932101 -0.10232173526656242191 0.26347530892838588734 -0.097289947245479208027 0.18163889042658859507 0.024493084840201632263 -0.34159256589564523932 0.23398887704455365033 -0.19130247277785186744 -0.13307759630672838513 -0.01861001218378349753 0.15862532737171525232 0.11606648353926143913 0.30626415132547069042 -0.28674812418300554828 0.39873047054821009194 -0.11636906438196875646 -0.13097656336756571815 0.49133172408599556924 -0.17498448941275071555 -0.17502805845298452514 -0.0038722735766519617191 -0.18735237007405849963 -0.37932315816065759195 -0.1280293016332871292 -0.043732188317331312233 0.0084525852038420633272 0.17745889406322767901 0.13809401656167030747 -0.033954781954395725496 0.39927513279954185421;-0.22471180491732128948 -0.19124661754906260858 -0.52320501256402851542 -0.33265660368023602933 0.44582349506892371416 0.19330849701447272437 0.16687641109316364574 1.0086346003831623275 0.75511939500070546227 -1.5635298730369611153 0.047124772789655634819 0.3025230209790421565 -0.8091242462224486065 -0.63173301817628513266 0.47726413399492745304 0.45108117819760878975 -0.17179767589817973583 0.78180192159455630385 1.0184611395482789931 -1.585361231741774235 -0.54520803040443244214 -0.17683517045585267491 -0.19104812055069247956 -0.086600851994988695126 -0.10770870702226374716 -0.26574630098243939846 -0.77263091715772025392 1.0081734562245756592 0.13760924147620196001 0.047960293311825052953 0.023422155646483491798 -0.41530376500196702905 -0.37126958909117152574 0.4379410988637630342 0.47058181231016271706 -0.18257751607750677403 -0.88645563864044063518 0.96848275693522267726 0.8358231394741068021 -0.21235661791409174426;1.2271955831785239521 -0.16443253698039139721 0.14340223633614693211 -0.43085971571755571352 -0.28676064325945432865 -0.016945805518275267737 -0.50879087063296091209 0.60441816032875228526 -1.5268264808032936397 0.53321988686044630157 1.146337465729381222 -0.14066855042537629306 0.19074992788969630242 -0.35888435312531735688 0.14268096765643889512 -0.028737100479256278557 -0.08510683739807543835 -0.13958709546935130219 -1.4332058499259852091 0.26458911246777144788 1.368913123300710577 0.62499776703054210625 -0.47390640113432203062 -0.15105570367381621066 -0.072549581747941419008 0.24608240768297590106 -0.0061215824401302165389 0.48333097881857239875 -0.6338852111694781577 -0.094697195648421092495 1.4389459564727105079 0.58184184098461599888 -0.66424818903200311127 -1.5207217119346685408 -0.13175555997601762215 -0.10874591397622142275 0.35146871896663656187 0.31971887395735998361 -1.3150137797059588962 0.52128771952778518717;-0.082210530047875582382 -0.037992065112167912322 1.0479511036387298972 -0.25452224357959729595 1.1894851270691211287 1.1356701823905994697 -1.6549520908876276248 -1.9815371497395393163 0.00096866869469734457471 -0.59129417731181643791 0.34517037800881367193 0.022223548225566793629 1.3766105608317618092 -0.55280678260660709444 1.2537698966722246041 0.42754114585126545833 -1.5028238706011385339 -1.4698860879966784143 -0.45940085556635096298 -0.5974491366690561911 -0.1532567689255015797 0.54263665551119300012 0.63187721629860660322 0.50022560140412797303 0.94467434401867778071 0.089411119522147336491 -0.72962773719885054557 -1.1262765237870058233 0.079428069169293610829 0.22905873856890571205 0.086357687750271722171 0.30821935430700514447 1.0246416317227995396 0.59925543534286751512 1.3560819999451536599 0.20614240452914439627 -1.8253900202497685967 -1.9247571385370672026 0.00043481977485747053038 -0.45658616696664133805;-0.15809040166395610383 0.060017060879470701673 0.27150810736517089206 -0.14512461466551421219 0.091536921995091363735 -0.39961511011917938418 0.11543573557742835278 -0.48658617095899198146 -0.11154952824076524998 -0.068583630204227780114 -0.25756037942102738558 0.34436800462133509981 -0.07651131248645638705 0.17863181245206255499 -0.41470596133728987454 -0.38117147177287263871 0.25886640837375923807 -0.36145353452034645336 -0.52358205887708963999 -0.1190351444749215698 -0.061833187939343031703 -0.24051038383951875432 -0.10917215100520517856 0.039107778087247996313 -0.4229090596396618551 0.076572061061576851548 0.16934569690276893295 -0.10064069278780984895 -0.37535917827867953944 -0.50263512368534668528 -0.21876196390835211947 -0.0084550309179426495071 -0.30673321151850158062 -0.111144393609811723 -0.42483186356255131511 -0.37349311800910750536 -0.54057534184769284735 -0.27794625241391396342 0.23185130701107439788 -0.23163121982128101473;-0.23084517152589922873 -0.66647172853409286652 0.98256552519691620073 0.25977608746109143167 -0.48740974872793907391 0.086005580781705642801 1.6640352453936304578 0.60338570291455151384 -0.67746761943228728242 -1.2235660238948875556 0.11790100842444442564 -0.26576439313544242271 1.0299183517923726772 0.47279873898121982378 -0.59370395331114034221 -0.34772220780145091101 1.7885337055217214175 1.0227909097135541305 -0.35290969928294851909 -0.88684433451466260223 -0.26234638057157044777 -0.61498981585061274213 0.064780052198630797 -0.084830429750815811163 0.092842400987381099031 -0.1628872146717295355 0.51806460127822240302 0.010547995192310354387 -0.87562533836457812075 -0.78512296330436071035 -0.32983140982642744632 -0.64369346571046504035 0.61607742126849340814 0.3033265396859015639 0.11935772706708316915 -0.29199532895291335777 0.50549483327702848801 0.83041146712713187483 -1.1793189957427130388 -0.84915466251374494;0.12780605491685792519 1.3198984974003586945 -0.04204072299957688913 -0.35031583982413799783 0.25734122381482782416 0.15564225734567438408 -1.3084245438407124951 0.59556092263642346207 -0.0067537992111402645606 -0.35440171574179585301 0.47552866065826537856 1.0115730352487617427 -0.15778760279257936228 0.0639370536918773269 0.20558416333638210305 0.11307983421110993916 -1.465219529283737776 0.65808436237937506519 0.064301184437322647658 -0.75559931059106211215 -0.025764521020947901697 1.0023661941761750072 -0.388008487493290255 -0.63984350342970919279 0.43805390124425191978 -0.059866436047216288474 -1.0174150210144228268 0.81751557022555676468 -0.26864952747184783766 -0.21125790512424083567 -0.057484891376914787342 0.99934530199208093659 -1.1493745947947280328 -1.1634032124668001185 -0.16770103371947514548 -0.23919555136291989483 -1.2429077649022992613 0.67309918855420958206 -0.49493797201571043676 0.37006710323359753856];

% Layer 2
b2 = [-0.50874705742430381683;-0.36773413682990718776;0.36759476033922050542;-0.45338666049483145049;-0.47052005709930461164;0.90978671200568927979;-0.77153846964192840385;-0.19701987761111225406;-0.050324076202820020032;0.10455458926781326101;1.0367414540552581936;-0.21528585887233420149];
LW2_1 = [-1.8163113064070164349 0.2670090291353623968 -0.44663796447767800668 0.47103628273564873696 -0.2552897800038889109 -1.5058145167578644852 3.1831539331359497425 -0.0062758354551289818185 -2.4166996794272153082 -0.32512744484685696111;-2.4549964124468521831 -1.1513944842500964949 0.015008990794888153394 0.0053265283672679544086 -0.65678136825699273693 0.27527360496269587253 2.5435958457330838378 -0.60564875770098081098 -1.7625106924030726763 2.6580770557682686928;0.44309806703268705963 -1.7638647099207296343 -0.340329631368698593 0.87561553691844784542 2.2423833941885735754 -2.689703357276020057 2.5722113425090711303 -0.95721770020819341163 -0.26830375007093598683 0.2693066640812473711;-1.9881902257779213716 2.9199203205370443115 -0.8648145838359858617 0.28486374413876058842 1.0262677693287434177 -1.5279923052820438834 -0.013436826975328783687 0.24413924119828761539 0.74856566439848393202 -1.202824355092316555;-0.16487574721812783829 -1.5745727120712420533 0.69142925431349455678 0.25090909097852120979 0.82964420313363995696 -0.94721801660881355112 -2.3074431229861200876 -0.38661293717736633369 1.9254397835773995329 -2.833468616543140417;0.81366113405382400892 -0.79544009840747209594 -0.91624091377715233264 0.55694672040648163236 -1.4566319350814103117 -1.8005767460152175552 0.035717034774286275656 -0.48767005279196601331 -1.3086375255491979885 -1.054001192377445939;0.71967372963013909182 -2.1682905031712786936 1.3291409046185600484 -0.45859654884691358756 -3.0855683450847077864 2.6438638882444291944 -1.0164247887476836052 0.65234396123423132874 -0.34880128975691199189 -1.8241882668764610731;1.1621385282016261087 -1.9297382698824592229 -0.26406645991794830408 0.36437532769719976899 0.85028854235736839318 -0.54100411629359879129 -1.5762736484801092018 0.13604391016522696112 -1.229759792539873553 -1.0222323457212181275;2.6570864813817691719 1.3305876437761181563 -0.25988407084072628894 1.0224536380495832244 0.94280457931641503677 0.71065438731097785308 -2.4319668437772046232 0.17424570965707464332 0.27194138223448166558 2.5479176746810199283;0.7608326948002780421 1.90663969026678215 0.32568820918484636673 -0.38244098228714440424 -0.5788493541507694351 0.90949305087455933894 1.4810045918954239941 0.026009574986181376727 3.4395544933314572411 -0.44395830152191090301;1.6501536660120081912 1.8814112561010545299 0.66113412985944797207 0.21019698007171738752 1.6746031938025691677 0.81824871950385658081 -1.7378241744259801393 -0.39795377435897866247 0.17595984350425497578 2.3142893908786166257;-1.5756481744779942122 0.54291147194719946434 -0.60317651244007097766 -0.071068045514902963844 0.4284410626486060969 0.27248825489762329433 -1.1543680263144913134 -0.44677250031255222318 -1.0871443349698579617 2.4385061344815026629];

% ===== SIMULATION ========

% Format Input Arguments
isCellX = iscell(X);
if ~isCellX
    X = {X};
end

% Dimensions
TS = size(X,2); % timesteps
if ~isempty(X)
    Q = size(X{1},1); % samples/series
else
    Q = 0;
end

% Allocate Outputs
Y = cell(1,TS);

% Time loop
for ts=1:TS
    
    % Input 1
    X{1,ts} = X{1,ts}';
    Xp1 = mapminmax_apply(X{1,ts},x1_step1);
    
    % Layer 1
    a1 = tansig_apply(repmat(b1,1,Q) + IW1_1*Xp1);
    
    % Layer 2
    a2 = softmax_apply(repmat(b2,1,Q) + LW2_1*a1);
    
    % Output 1
    Y{1,ts} = a2;
    Y{1,ts} = Y{1,ts}';
end

% Final Delay States
Xf = cell(1,0);
Af = cell(2,0);

% Format Output Arguments
if ~isCellX
    Y = cell2mat(Y);
end
end

% ===== MODULE FUNCTIONS ========

% Map Minimum and Maximum Input Processing Function
function y = mapminmax_apply(x,settings)
y = bsxfun(@minus,x,settings.xoffset);
y = bsxfun(@times,y,settings.gain);
y = bsxfun(@plus,y,settings.ymin);
end

% Competitive Soft Transfer Function
function a = softmax_apply(n,~)
if isa(n,'gpuArray')
    a = iSoftmaxApplyGPU(n);
else
    a = iSoftmaxApplyCPU(n);
end
end
function a = iSoftmaxApplyCPU(n)
nmax = max(n,[],1);
n = bsxfun(@minus,n,nmax);
numerator = exp(n);
denominator = sum(numerator,1);
denominator(denominator == 0) = 1;
a = bsxfun(@rdivide,numerator,denominator);
end
function a = iSoftmaxApplyGPU(n)
nmax = max(n,[],1);
numerator = arrayfun(@iSoftmaxApplyGPUHelper1,n,nmax);
denominator = sum(numerator,1);
a = arrayfun(@iSoftmaxApplyGPUHelper2,numerator,denominator);
end
function numerator = iSoftmaxApplyGPUHelper1(n,nmax)
numerator = exp(n - nmax);
end
function a = iSoftmaxApplyGPUHelper2(numerator,denominator)
if (denominator == 0)
    a = numerator;
else
    a = numerator ./ denominator;
end
end

% Sigmoid Symmetric Transfer Function
function a = tansig_apply(n,~)
a = 2 ./ (1 + exp(-2*n)) - 1;
end
